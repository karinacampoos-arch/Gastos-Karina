<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Gastos Karina</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#0e0f13;
  --card:#181a20;
  --input:#22252d;
  --text:#f1f1f1;
  --sub:#9aa0a6;
  --green:#25D366;
  --blue:#4f7cff;
  --red:#ff5c5c;
}
body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}
.container{
  max-width:420px;
  margin:auto;
  padding:24px;
}
h1{
  text-align:center;
  font-size:20px;
  margin-bottom:6px;
}
.subtitle{
  text-align:center;
  font-size:13px;
  color:var(--sub);
  margin-bottom:20px;
}
.card{
  background:var(--card);
  padding:22px;
  border-radius:16px;
}
label{
  display:block;
  margin-top:14px;
  font-size:13px;
  color:var(--sub);
}
input{
  width:100%;
  padding:14px;
  margin-top:6px;
  border:none;
  border-radius:10px;
  background:var(--input);
  color:var(--text);
  font-size:16px;
}
button{
  width:100%;
  padding:14px;
  margin-top:14px;
  border:none;
  border-radius:12px;
  font-size:15px;
  cursor:pointer;
}
.salvar{ background:var(--blue); color:#fff; }
.lucro{ background:#2ecc71; color:#000; font-weight:600; }
.apagar{ background:var(--red); color:#fff; }
.fechar{ background:var(--green); color:#000; font-weight:600; }

.resumo{
  margin-top:16px;
  font-size:14px;
}
.historico{
  margin-top:20px;
  font-size:13px;
  color:var(--sub);
}
</style>
</head>

<body>
<div class="container">
  <h1>Gastos Karina</h1>
  <div class="subtitle">Controle mensal simples</div>

  <div class="card">
    <label>Valor (R$)</label>
    <input type="number" id="valor" placeholder="Ex: 120">

    <label>Descri√ß√£o</label>
    <input type="text" id="descricao" placeholder="Ex: Material / Servi√ßo">

    <button class="salvar" onclick="salvar('gasto')">Salvar gasto</button>
    <button class="lucro" onclick="salvar('lucro')">Salvar lucro</button>
    <button class="apagar" onclick="apagarUltimo()">Apagar √∫ltimo lan√ßamento</button>

    <div class="resumo" id="resumo"></div>

    <button class="fechar" onclick="fecharMes()">Fechar m√™s (12:00)</button>

    <div class="historico" id="historico"></div>
  </div>
</div>

<script>
const ID = "karina-financeiro";
const WHATSAPP = "5511964568408";

function mesAtual(){
  const d = new Date();
  return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0");
}
function hoje(){
  return new Date().toISOString().split("T")[0];
}

/* üîê BACKUP AUTOM√ÅTICO */
function backup(){
  const dataHora = new Date().toISOString();
  const dados = localStorage.getItem(ID+"-"+mesAtual());
  if(dados){
    localStorage.setItem(ID+"-backup-"+dataHora, dados);
  }
}

function carregar(){
  const dados = JSON.parse(localStorage.getItem(ID+"-"+mesAtual())) || [];
  let gastos = 0, lucros = 0;

  dados.forEach(i=>{
    i.tipo === "gasto" ? gastos += i.valor : lucros += i.valor;
  });

  const resultado = lucros - gastos;
  const status = resultado >= 0 ? "‚úÖ POSITIVO" : "‚ùå NEGATIVO";

  document.getElementById("resumo").innerHTML =
    "üí∏ Gastos: R$ " + gastos.toFixed(2) + "<br>" +
    "üí∞ Lucros: R$ " + lucros.toFixed(2) + "<br>" +
    "üìä Resultado: R$ " + resultado.toFixed(2) + "<br>" +
    status;

  document.getElementById("historico").innerHTML =
    dados.map(i =>
      `‚Ä¢ ${i.tipo.toUpperCase()} ‚Äì R$ ${i.valor.toFixed(2)} (${i.desc})`
    ).join("<br>");
}

function salvar(tipo){
  const valor = document.getElementById("valor").value;
  const desc = document.getElementById("descricao").value || "-";
  if(!valor){
    alert("Informe um valor");
    return;
  }

  let dados = JSON.parse(localStorage.getItem(ID+"-"+mesAtual())) || [];
  dados.push({ tipo, valor: parseFloat(valor), desc });
  localStorage.setItem(ID+"-"+mesAtual(), JSON.stringify(dados));

  backup();

  document.getElementById("valor").value = "";
  document.getElementById("descricao").value = "";
  carregar();
}

function apagarUltimo(){
  let dados = JSON.parse(localStorage.getItem(ID+"-"+mesAtual())) || [];
  if(dados.length === 0){
    alert("Nada para apagar");
    return;
  }
  dados.pop();
  localStorage.setItem(ID+"-"+mesAtual(), JSON.stringify(dados));
  backup();
  carregar();
}

function fecharMes(){
  const chaveFechamento = ID + "-fechado-" + mesAtual();
  if(localStorage.getItem(chaveFechamento) === hoje()){
    alert("‚ö†Ô∏è O m√™s j√° foi fechado hoje.\nFechamento duplicado bloqueado.");
    return;
  }

  const dados = JSON.parse(localStorage.getItem(ID+"-"+mesAtual())) || [];
  let gastos=0, lucros=0;
  dados.forEach(i=> i.tipo==="gasto" ? gastos+=i.valor : lucros+=i.valor);
  const resultado = lucros - gastos;
  const status = resultado >= 0 ? "POSITIVO" : "NEGATIVO";

  localStorage.setItem(chaveFechamento, hoje());
  backup();

  const texto =
    "üìä *Resumo financeiro ‚Äì Karina*%0A%0A"+
    "üí∏ Gastos: R$ "+gastos.toFixed(2)+"%0A"+
    "üí∞ Lucros: R$ "+lucros.toFixed(2)+"%0A"+
    "üìà Resultado: R$ "+resultado.toFixed(2)+"%0A"+
    "*Situa√ß√£o:* "+status+"%0A%0A"+
    "‚è∞ Fechamento registrado √†s 12:00";

  window.open("https://wa.me/"+WHATSAPP+"?text="+texto,"_blank");
}

carregar();
</script>
</body>
</html>

